<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="内容[TOC]">
<meta property="og:type" content="article">
<meta property="og:title" content="UnityShader">
<meta property="og:url" content="http://example.com/2023/05/06/UnityShader/index.html">
<meta property="og:site_name" content="心梦">
<meta property="og:description" content="内容[TOC]">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/image-20230508123426929.png">
<meta property="og:image" content="http://example.com/images/image-20230508123733246.png">
<meta property="og:image" content="http://example.com/images/image-20230508124239459.png">
<meta property="og:image" content="http://example.com/images/image-20230508134159808.png">
<meta property="og:image" content="http://example.com/images/image-20230506181906689.png">
<meta property="og:image" content="http://example.com/images/image-20230509153201669.png">
<meta property="og:image" content="http://example.com/images/image-20230509153549241.png">
<meta property="og:image" content="http://example.com/images/image-20230509153628051.png">
<meta property="og:image" content="http://example.com/images/image-20230509153840191.png">
<meta property="og:image" content="http://example.com/images/image-20230509154021492.png">
<meta property="og:image" content="http://example.com/images/image-20230509164630883.png">
<meta property="og:image" content="http://example.com/images/image-20230509181116997.png">
<meta property="og:image" content="http://example.com/images/image-20230516120119488.png">
<meta property="article:published_time" content="2023-05-06T07:53:49.000Z">
<meta property="article:modified_time" content="2023-05-16T04:01:20.216Z">
<meta property="article:author" content="心梦">
<meta property="article:tag" content="图形学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/image-20230508123426929.png">

<link rel="canonical" href="http://example.com/2023/05/06/UnityShader/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>UnityShader | 心梦</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="心梦" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">心梦</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>资源</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    

  <a href="https://github.com/heartdream520" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/06/UnityShader/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ailulu.jpg">
      <meta itemprop="name" content="心梦">
      <meta itemprop="description" content="heart_dream">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="心梦">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UnityShader
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-05-06 15:53:49" itemprop="dateCreated datePublished" datetime="2023-05-06T15:53:49+08:00">2023-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-16 12:01:20" itemprop="dateModified" datetime="2023-05-16T12:01:20+08:00">2023-05-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">图形学</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>32k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>29 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h1><p>[TOC]</p>
<span id="more"></span>

<h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><h2 id="基本类型表达式"><a href="#基本类型表达式" class="headerlink" title="基本类型表达式"></a>基本类型表达式</h2><p><img src="/../images/image-20230508123426929.png" alt="image-20230508123426929"></p>
<h2 id="结构体和语义"><a href="#结构体和语义" class="headerlink" title="结构体和语义"></a>结构体和语义</h2><p><img src="/../images/image-20230508123733246.png" alt="image-20230508123733246"></p>
<h2 id="unity支持的shader语义"><a href="#unity支持的shader语义" class="headerlink" title="unity支持的shader语义"></a>unity支持的shader语义</h2><p>在 Unity 中，支持的 Shader 语义如下：</p>
<p>POSITION：表示顶点位置。</p>
<p>NORMAL：表示顶点法线。</p>
<p>COLOR：表示顶点颜色。</p>
<p>TEXCOORD0：表示主纹理坐标。</p>
<p>TEXCOORD1：表示第二个纹理坐标。</p>
<p>TEXCOORD2：表示第三个纹理坐标。</p>
<p>TEXCOORD3：表示第四个纹理坐标。</p>
<p>TANGENT：表示切线。</p>
<p>BINORMAL：表示副切线。</p>
<p>VIEW_DIRECTION：表示视图方向。</p>
<p>SCREEN_POSITION：表示屏幕上的位置。</p>
<p>SV_POSITION：表示像素在屏幕上的位置。</p>
<p>DEPTH：表示深度值。</p>
<p>TARGET：表示渲染目标。</p>
<p>SV_TARGET：表示像素着色器输出的颜色渲染目标。</p>
<p>COLOR0, COLOR1, COLOR2, COLOR3：表示颜色缓冲区。</p>
<p>DEPTH_STENCIL：表示深度&#x2F;模板缓冲区。</p>
<p>SV_Depth：表示像素深度值。</p>
<h2 id="标准内置函数"><a href="#标准内置函数" class="headerlink" title="标准内置函数"></a>标准内置函数</h2><p><img src="/../images/image-20230508124239459.png" alt="image-20230508124239459"></p>
<h2 id="float4-fixed4-Time"><a href="#float4-fixed4-Time" class="headerlink" title="float4 fixed4 _Time"></a>float4 fixed4 _Time</h2><p><img src="/../images/image-20230508134159808.png" alt="image-20230508134159808"></p>
<h2 id="UnityObjectToClipPos"><a href="#UnityObjectToClipPos" class="headerlink" title="UnityObjectToClipPos"></a>UnityObjectToClipPos</h2><p><code>UnityObjectToClipPos</code> 是Unity中的内置函数，用于将顶点位置从对象空间转换到剪裁空间。它接受一个<code>float4</code>类型的向量，表示顶点的位置，返回一个<code>float4</code>类型的向量，表示变换后的剪裁空间中的位置。</p>
<p>在Shader中，我们通常使用<code>UnityObjectToClipPos</code>将顶点位置从对象空间转换到剪裁空间。这是因为在剪裁空间中，所有的几何体都是以相对于摄像机的位置来表示的，这使得在屏幕上进行投影和裁剪变得更加容易。此外，在剪裁空间中，所有的几何体都是以标准化设备坐标（NDC）表示的，这使得深度测试、深度剔除和颜色插值等操作都更加方便。</p>
<p><code>UnityObjectToClipPos</code>函数通常被用在顶点着色器中，用于将顶点的位置从对象空间转换到剪裁空间，例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arduinoCopy codefloat4 <span class="title function_">vert</span> <span class="params">(appdata v)</span> : SV_POSITION</span><br><span class="line">&#123;</span><br><span class="line">    float4 clipPos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">    <span class="keyword">return</span> clipPos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个顶点着色器接受一个结构体类型的输入<code>appdata</code>，表示传入的顶点数据，输出一个<code>float4</code>类型的向量，表示变换后的剪裁空间中的顶点位置。在这个顶点着色器中，我们使用<code>UnityObjectToClipPos</code>将顶点的位置从对象空间转换到剪裁空间，并返回变换后的剪裁空间中的顶点位置。</p>
<h2 id="SV-POSITION"><a href="#SV-POSITION" class="headerlink" title="SV_POSITION"></a>SV_POSITION</h2><p><code>SV_POSITION</code>是在HLSL中使用的一种内置的语义（semantic），用于表示当前变量是一个顶点着色器的输出，它表示输出的是一个顶点的位置。</p>
<p>在Unity的Shader中，当使用<code>CGPROGRAM</code>和<code>ENDCG</code>包含着色器代码时，可以使用<code>SV_POSITION</code>语义来指定顶点着色器输出的变量类型为顶点位置。这个语义通常用于将顶点位置从对象空间（Object Space）转换到剪裁空间（Clip Space），或者进行屏幕空间的计算。</p>
<p>例如，下面是一个使用<code>SV_POSITION</code>语义的顶点着色器：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">arduinoCopy code<span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">appdata</span> &#123;</span></span><br><span class="line">    float4 vertex : POSITION;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line">    float4 pos : SV_POSITION;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">v2f <span class="title function_">vert</span><span class="params">(appdata v)</span> &#123;</span><br><span class="line">    v2f o;</span><br><span class="line">    o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个着色器中，<code>SV_POSITION</code>语义被用来指定输出变量<code>pos</code>的类型为顶点位置。顶点着色器将传入的<code>POSITION</code>数据转换到剪裁空间，并将结果存储在输出变量<code>pos</code>中，这个变量将会被传递到后续的像素着色器进行处理。</p>
<h2 id="Diffuse"><a href="#Diffuse" class="headerlink" title="Diffuse"></a>Diffuse</h2><p><code>Diffuse</code>是一种渲染模型，用于在计算每个像素的颜色时考虑物体表面的漫反射属性。在这个模型中，每个像素的颜色由以下公式计算得出：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color = BaseColor * LightColor * (DiffuseFactor * NdotL)</span><br></pre></td></tr></table></figure>

<p>其中，<code>BaseColor</code>表示物体的基础颜色，<code>LightColor</code>表示光源的颜色，<code>DiffuseFactor</code>表示物体表面的漫反射系数，<code>NdotL</code>表示法线向量和光照方向的点积。</p>
<p>在Unity中的Standard Shader和Legacy Shader中，都使用了<code>Diffuse</code>渲染模型。在Standard Shader中，它被作为一种可选的光照模型，可以在Inspector面板中的Material属性中进行设置；在Legacy Shader中，则是默认的渲染模型。</p>
<h2 id="SV-Target"><a href="#SV-Target" class="headerlink" title="SV_Target"></a>SV_Target</h2><p><code>SV_Target</code> 是 DirectX&#x2F;HLSL 中的一个语义，用于指定像素着色器输出颜色的目标渲染目标（color buffer），也就是要将像素着色器计算出来的颜色写入到哪个渲染目标中。<code>SV_Target</code> 的值是一个系统值语义，代表像素着色器输出颜色的目标缓冲区编号。</p>
<h2 id="Properties属性"><a href="#Properties属性" class="headerlink" title="Properties属性"></a>Properties属性</h2><p>在 Unity 的 Shader 中，<code>Properties</code> 是用于定义材质属性（Material Properties）的一种语法。材质属性是指在 Unity 中定义的可以修改材质外观的属性，例如纹理、颜色、数值等等。通过在 Shader 中定义 Properties，可以将材质属性传递给 Shader，以便在 Shader 中使用这些属性来修改材质的外观。</p>
<p>下面是一个简单的例子，展示了如何在 Shader 中定义一个纹理属性：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mathematicaCopy codeProperties &#123;</span><br><span class="line">    _MainTex (<span class="string">&quot;Texture&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;white&quot;</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>_MainTex</code> 是一个纹理属性的名称，<code>(&quot;Texture&quot;, 2D)</code> 表示这是一个二维纹理，并且默认使用一个白色纹理，最后的大括号表示这个属性没有特殊的限制或标签。</p>
<p>除了纹理属性，还可以定义其他类型的材质属性，例如颜色、浮点数、向量等等。通过定义 Properties，可以使 Shader 具有更好的可配置性和灵活性。</p>
<h2 id="TRANSFORM-TEX"><a href="#TRANSFORM-TEX" class="headerlink" title="TRANSFORM_TEX"></a>TRANSFORM_TEX</h2><p>TRANSFORM_TEX 是 Unity 中的一个宏定义，用于在自定义着色器中对纹理坐标进行变换。在使用这个宏定义之前，需要在自定义着色器的 SubShader 中添加以下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>这个指令引入了 UnityCG.cginc 文件，该文件中包含了一些和着色器编程相关的函数和宏定义，包括 TRANSFORM_TEX。</p>
<p>TRANSFORM_TEX 宏定义用于将纹理坐标从对象空间或投影空间转换为纹理空间。例如，下面的代码将从一个名为 “_MainTex” 的纹理中采样一个颜色，并将纹理坐标从对象空间转换到纹理空间：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fixed4 <span class="title">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span></span><br><span class="line">   fixed4 col = <span class="built_in">tex2D</span>(_MainTex, <span class="built_in">TRANSFORM_TEX</span>(i.uv, _MainTex));</span><br><span class="line">   <span class="keyword">return</span> col;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中，i.uv 是输入结构体中传递进来的纹理坐标，_MainTex 是一个名为 “_MainTex” 的纹理，TRANSFORM_TEX(i.uv, _MainTex) 将 i.uv 从对象空间转换到 _MainTex 纹理的纹理空间。</p>
<p>需要注意的是，TRANSFORM_TEX 宏定义只对从对象空间或投影空间采样纹理的情况有效。对于直接从纹理坐标中采样纹理的情况，不需要使用 TRANSFORM_TEX。</p>
<h2 id="tex2D"><a href="#tex2D" class="headerlink" title="tex2D"></a>tex2D</h2><p><code>tex2D</code> 是 Unity 中用于从纹理中获取颜色值的函数。它的语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fixed4 tex2D(sampler2D sampler, float2 uv);</span><br></pre></td></tr></table></figure>

<p>其中 <code>sampler</code> 是一个 2D 纹理采样器，<code>uv</code> 是纹理坐标，返回值是一个 <code>fixed4</code> 类型的颜色值。</p>
<p><code>tex2D</code> 可以用于顶点着色器和像素着色器中，用于从纹理中获取对应位置的颜色值进行计算。例如，下面的代码从 <code>_MainTex</code> 纹理中获取 <code>i.uv</code> 坐标处的颜色，并将其作为像素着色器的输出颜色：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fixed4 frag(v2f i) : SV_Target &#123;</span><br><span class="line">    fixed4 col = tex2D(_MainTex, i.uv);</span><br><span class="line">    return col;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，如果纹理的格式不支持 alpha 通道，则 <code>fixed4</code> 类型的返回值中的 alpha 值将被忽略。如果需要获取 3 通道（RGB）的颜色值，则可以使用 <code>tex2D.rgb</code> 来获取。</p>
<h1 id="模型空间、世界空间、观察空间和裁剪空间"><a href="#模型空间、世界空间、观察空间和裁剪空间" class="headerlink" title="模型空间、世界空间、观察空间和裁剪空间"></a>模型空间、世界空间、观察空间和裁剪空间</h1><p>模型空间、世界空间、观察空间和裁剪空间是计算机图形学中常见的坐标空间，它们用于描述三维物体的位置和方向，并且在渲染管线中扮演重要角色。</p>
<ul>
<li>模型空间（Model Space）：是指物体的本地坐标系，即在物体自身坐标系下描述的坐标。在模型空间中，物体的原点一般位于其几何中心。</li>
<li>世界空间（World Space）：是指在全局坐标系下描述的坐标系，所有物体都共享同一个世界坐标系。在世界空间中，物体的位置是相对于全局原点的。</li>
<li>观察空间（View Space&#x2F;Camera Space）：是指相机拍摄时的坐标系，相机位于坐标系原点，观察方向为z轴负方向，x轴和y轴分别表示相机视野中的水平和垂直方向。</li>
<li>裁剪空间（Clip Space）：是指相机空间中的坐标经过投影变换（投影矩阵）后得到的坐标系。在裁剪空间中，所有坐标都在范围[-1,1]之间。这个坐标系是为了方便进行透视变换，把物体从三维空间投影到二维屏幕上。</li>
</ul>
<p>在渲染管线中，顶点着色器把模型空间中的顶点转换为裁剪空间中的顶点，然后光栅化阶段把裁剪空间中的几何图元转换为屏幕空间中的像素，最终显示在屏幕上。在这个过程中，我们需要对坐标进行多次变换和计算，以便在不同的坐标空间中进行正确的渲染和投影。</p>
<h1 id="01"><a href="#01" class="headerlink" title="01"></a>01</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/01&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex(<span class="string">&quot;Texture&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;red&quot;</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">        SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            </span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            float4 <span class="built_in">vert</span>(float4 v : POSITION) : SV_POSITION &#123;</span><br><span class="line">            </span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">UnityObjectToClipPos</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function">fixed4 <span class="title">frag</span> <span class="params">()</span> : SV_Target&#123;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">fixed4</span>(<span class="number">1.0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;Diffuse&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>- </p>
<h1 id="02"><a href="#02" class="headerlink" title="02"></a>02</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Unlit/02&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//_MainTex(&quot;Texture&quot;, 2D) = &quot;red&quot; &#123;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//Tags &#123; &quot;RenderType&quot; = &quot;Opaque&quot; &#125;</span></span><br><span class="line">       <span class="comment">// LOD 100</span></span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="comment">//指定顶点着色器</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="comment">//指定片元着色器</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="keyword">struct</span> <span class="title class_">a2v</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">                <span class="comment">// 模型的第一套纹理</span></span><br><span class="line">                float4 texcoord:TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            <span class="function">float4 <span class="title">vert</span><span class="params">(a2v v )</span> : SV_POSITION &#123;</span></span><br><span class="line">            <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">UnityObjectToClipPos</span>(v.vertex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function">fixed4 <span class="title">frag</span><span class="params">()</span> : SV_Target&#123;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">fixed4</span>(<span class="number">1.0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1.0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ENDCG</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        FallBack <span class="string">&quot;Diffuse&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="帧调试器"><a href="#帧调试器" class="headerlink" title="帧调试器"></a>帧调试器</h1><p><img src="/../images/image-20230506181906689.png" alt="image-20230506181906689"></p>
<h1 id="Shader-Target-编译的目标平台"><a href="#Shader-Target-编译的目标平台" class="headerlink" title="Shader Target 编译的目标平台"></a>Shader Target 编译的目标平台</h1><p>Shader Target（Shader目标）是指编写 Shader 时要编译的目标平台，即目标 GPU 和渲染 API。在 Unity 中，Shader Target 由以下两个部分组成：</p>
<ol>
<li>GPU 类型：表示目标平台的 GPU 类型，例如 DirectX 11、OpenGL ES 3.0、Metal、PlayStation 4 等。</li>
<li>渲染 API：表示目标平台的渲染 API，例如 DirectX 11、OpenGL ES 3.0、Metal、Vulkan 等。</li>
</ol>
<p>Shader Target 会影响 Shader 代码的编写方式和可用的特性和功能。例如，不同的 GPU 类型可能有不同的指令集和限制，需要使用不同的指令和优化技巧来实现最佳性能。而不同的渲染 API 可能具有不同的特性和限制，例如 DirectX 11 支持 Compute Shader，而 OpenGL ES 3.0 不支持。</p>
<p>在 Unity 中，可以使用 <code>#pragma target</code> 指令来指定 Shader Target，例如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arduinoCopy code</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> target 3.0</span></span><br></pre></td></tr></table></figure>

<p>这个指令表示编写的 Shader 目标平台是 OpenGL ES 3.0。Unity 支持的 Shader Target 取决于 Unity 版本和目标平台，具体支持的 Shader Target 可以在 Unity 的官方文档中查看。</p>
<h1 id="BRDF模型"><a href="#BRDF模型" class="headerlink" title="BRDF模型"></a>BRDF模型</h1><p>BRDF（Bidirectional Reflectance Distribution Function，双向反射分布函数）是计算光在物体表面反射的分布规律的函数模型，用于描述光线从一个给定的方向射入物体表面后，以不同方向反射的能量分布情况。</p>
<p>BRDF 可以看作是将入射光线和出射光线之间的关系表示为一个函数，用于计算每个出射方向上的反射率。在计算机图形学中，BRDF 通常用于模拟材质表面的光照效果，以生成逼真的图像。BRDF 模型通常包括两个部分：</p>
<ol>
<li>几何遮挡（Geometry Occlusion）：表示入射光线和出射光线之间的物理障碍物。该部分通常由微平面模型来描述，例如 Beckmann 分布、GGX 分布等。</li>
<li>光的分布规律（Light Distribution）：表示从入射方向射入的光线在各个出射方向上的能量分布情况。该部分通常由 Cook-Torrance 模型、Lambert 模型等来描述。</li>
</ol>
<p>BRDF 模型是计算机图形学中非常重要的概念，可以用于实现各种复杂的光照效果，例如金属、塑料、皮肤等材质的表现。在 Unity 中，可以使用内置的 Standard Shader 来实现基于 PBR（Physically Based Rendering，基于物理的渲染）的材质渲染，该 Shader 使用了 Cook-Torrance BRDF 模型来计算光照效果。</p>
<h1 id="反射光照"><a href="#反射光照" class="headerlink" title="反射光照"></a>反射光照</h1><h2 id="逐顶点漫反射光照"><a href="#逐顶点漫反射光照" class="headerlink" title="逐顶点漫反射光照"></a>逐顶点漫反射光照</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Unlit/01&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="comment">//#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line">            <span class="comment">//引用了Lighting.cginc文件，这个文件中包含了一些和光照计算相关的函数和变量。</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            <span class="comment">//定义了一个名为_Diffuse的uniform变量，用于存储物体表面的颜色。</span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="keyword">struct</span> <span class="title class_">a2v</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">                <span class="comment">// 模型的第一套纹理</span></span><br><span class="line">                float4 texcoord:TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">struct</span> <span class="title class_">v2f</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                <span class="comment">// 存储颜色信息</span></span><br><span class="line">                fixed3 color : COLOR0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="function">v2f <span class="title">vert</span><span class="params">(a2v v)</span> </span>&#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = <span class="built_in">UnityObjectToClipPos</span>(v.vertex);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//UNITY_LIGHTMODEL_AMBIENT.xyz;: 获取环境光照颜色。</span></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">                <span class="comment">//将顶点法线从模型空间转换到世界空间，并归一化。</span></span><br><span class="line">                fixed3 worldNormal = <span class="built_in">normalize</span>(<span class="built_in">mul</span>(v.normal, (float3x3)unity_WorldToObject));</span><br><span class="line">                <span class="comment">//获取光源在世界空间中的位置，并归一化。</span></span><br><span class="line">                fixed3 worldLight = <span class="built_in">normalize</span>(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                <span class="comment">//计算漫反射颜色，使用光源的颜色</span></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * <span class="built_in">saturate</span>(<span class="built_in">dot</span>(worldNormal, worldLight));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                o.color = ambient + diffuse;</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function">fixed4 <span class="title">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span></span><br><span class="line">               fixed3 c = i.color;</span><br><span class="line">               <span class="keyword">return</span> <span class="built_in">fixed4</span>(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="逐像素漫反射光照"><a href="#逐像素漫反射光照" class="headerlink" title="逐像素漫反射光照"></a>逐像素漫反射光照</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Unlit/逐像素漫反射&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="comment">//#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line">            <span class="comment">//引用了Lighting.cginc文件，这个文件中包含了一些和光照计算相关的函数和变量。</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            <span class="comment">//定义了一个名为_Diffuse的uniform变量，用于存储物体表面的颜色。</span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">a2v</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                float3 worldNormal:TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span><span class="params">(a2v v)</span> &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                <span class="comment">//将顶点法线从模型空间转换到世界空间，并归一化。</span></span><br><span class="line">                o.worldNormal = normalize(mul(v.normal, (float3x3)unity_WorldToObject));</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span><br><span class="line">               <span class="comment">//UNITY_LIGHTMODEL_AMBIENT.xyz;: 获取环境光照颜色。</span></span><br><span class="line">               fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">               fixed3 worldNormal=normalize(i.worldNormal);</span><br><span class="line">               fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line"></span><br><span class="line">               fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*saturate(dot(worldNormal,worldLightDir));</span><br><span class="line">               fixed3 c = ambient+diffuse;</span><br><span class="line">               <span class="keyword">return</span> fixed4(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;DIFFUSE&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="正旋波和UV动画"><a href="#正旋波和UV动画" class="headerlink" title="正旋波和UV动画"></a>正旋波和UV动画</h1><h2 id="sin波纹"><a href="#sin波纹" class="headerlink" title="sin波纹"></a>sin波纹</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/sin波纹&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (<span class="string">&quot;Texture&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;White&quot;</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags &#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> &#125;</span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> appdata</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span></span></span><br><span class="line"><span class="class">            &#123;</span></span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">                float4 vertex : SV_POSITION;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span> <span class="params">(appdata v)</span></span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//相对距离</span></span><br><span class="line">                <span class="type">float</span> dist=distance(v.vertex.xyz,float3(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">                <span class="comment">//正弦波</span></span><br><span class="line">                <span class="type">float</span> h=<span class="built_in">sin</span>(dist+_Time.z);</span><br><span class="line">                <span class="comment">//模型空间变为到世界空间</span></span><br><span class="line">                o.vertex=mul(unity_ObjectToWorld,v.vertex);</span><br><span class="line">                <span class="comment">//改变Y的位置</span></span><br><span class="line">                o.vertex.y=h;</span><br><span class="line">                <span class="comment">//世界空间变为模型空间</span></span><br><span class="line">                o.vertex=mul(unity_WorldToObject,o.vertex);</span><br><span class="line">                <span class="comment">//模型空间变为裁剪空间</span></span><br><span class="line">                o.vertex = UnityObjectToClipPos(o.vertex);</span><br><span class="line">                <span class="comment">//对象空间或投影空间转化为纹理空间</span></span><br><span class="line">                o.uv = TRANSFORM_TEX(v.uv, _MainTex);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 <span class="title function_">frag</span> <span class="params">(v2f i)</span> : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//从纹理中获取颜色值</span></span><br><span class="line">                fixed4 col = tex2D(_MainTex, i.uv);</span><br><span class="line">                <span class="keyword">return</span> col;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="UV动画"><a href="#UV动画" class="headerlink" title="UV动画"></a>UV动画</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/sin波纹&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (<span class="string">&quot;Texture&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;White&quot;</span> &#123;&#125;</span><br><span class="line">        _SubTex (<span class="string">&quot;SubTexture&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;white&quot;</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags &#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> &#125;</span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> appdata</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> <span class="title class_">v2f</span></span><br><span class="line">            &#123;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">                float4 vertex : SV_POSITION;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">            sampler2D _SubTex;</span><br><span class="line">            float4 _SubTex_ST;</span><br><span class="line"></span><br><span class="line">            <span class="function">v2f <span class="title">vert</span> <span class="params">(appdata v)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//相对距离</span></span><br><span class="line">                <span class="type">float</span> dist=<span class="built_in">distance</span>(v.vertex.xyz,<span class="built_in">float3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">                <span class="comment">//正弦波</span></span><br><span class="line">                <span class="type">float</span> h=<span class="built_in">sin</span>(dist+_Time.z);</span><br><span class="line">                <span class="comment">//模型空间变为到世界空间</span></span><br><span class="line">                o.vertex=<span class="built_in">mul</span>(unity_ObjectToWorld,v.vertex);</span><br><span class="line">                <span class="comment">//改变Y的位置</span></span><br><span class="line">                o.vertex.y=h;</span><br><span class="line">                <span class="comment">//世界空间变为模型空间</span></span><br><span class="line">                o.vertex=<span class="built_in">mul</span>(unity_WorldToObject,o.vertex);</span><br><span class="line">                <span class="comment">//模型空间变为裁剪空间</span></span><br><span class="line">                o.vertex = <span class="built_in">UnityObjectToClipPos</span>(o.vertex);</span><br><span class="line">                <span class="comment">//对象空间或投影空间转化为纹理空间</span></span><br><span class="line">                o.uv = <span class="built_in">TRANSFORM_TEX</span>(v.uv, _MainTex);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">fixed4 <span class="title">frag</span> <span class="params">(v2f i)</span> : SV_Target</span></span><br><span class="line"><span class="function">            &#123;</span></span><br><span class="line">                <span class="comment">//从纹理中获取颜色值</span></span><br><span class="line">                float2 p=<span class="built_in">float2</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                p.x=_Time.y;</span><br><span class="line">                p.y=_Time.y;</span><br><span class="line">                <span class="comment">//计算动画颜色</span></span><br><span class="line">                fixed4 linght_col = <span class="built_in">tex2D</span>(_SubTex, i.uv+p);</span><br><span class="line">                fixed4 col = <span class="built_in">tex2D</span>(_MainTex, i.uv)+linght_col;</span><br><span class="line">                <span class="keyword">return</span> col;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="表面着色器"><a href="#表面着色器" class="headerlink" title="表面着色器"></a>表面着色器</h1><p><img src="/../images/image-20230509153201669.png" alt="image-20230509153201669"></p>
<h2 id="入口函数"><a href="#入口函数" class="headerlink" title="入口函数"></a>入口函数</h2><p><img src="/../images/image-20230509153549241.png" alt="image-20230509153549241"></p>
<h2 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h2><p><img src="/../images/image-20230509153628051.png" alt="image-20230509153628051"></p>
<h2 id="Input附加的数据"><a href="#Input附加的数据" class="headerlink" title="Input附加的数据"></a>Input附加的数据</h2><p><img src="/../images/image-20230509153840191.png" alt="image-20230509153840191"></p>
<h2 id="SurfaceOutput结构体"><a href="#SurfaceOutput结构体" class="headerlink" title="SurfaceOutput结构体"></a>SurfaceOutput结构体</h2><p><img src="/../images/image-20230509154021492.png" alt="image-20230509154021492"></p>
<h2 id="简单表面着色器代码"><a href="#简单表面着色器代码" class="headerlink" title="简单表面着色器代码"></a>简单表面着色器代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Custom/表面着色器&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (<span class="string">&quot;Color&quot;</span>, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _MainTex (<span class="string">&quot;Albedo (RGB)&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;white&quot;</span> &#123;&#125;</span><br><span class="line">        <span class="comment">//平滑度</span></span><br><span class="line">        _Glossiness (<span class="string">&quot;Smoothness&quot;</span>, Range(<span class="number">0</span>,<span class="number">1</span>)) = <span class="number">0.5</span></span><br><span class="line">        <span class="comment">//金属</span></span><br><span class="line">        _Metallic (<span class="string">&quot;Metallic&quot;</span>, Range(<span class="number">0</span>,<span class="number">1</span>)) = <span class="number">0.0</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags &#123; <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span> &#125;</span><br><span class="line">        LOD <span class="number">200</span></span><br><span class="line"></span><br><span class="line">        CGPROGRAM</span><br><span class="line">        <span class="comment">// Physically based Standard lighting model, and enable shadows on all light types</span></span><br><span class="line">        <span class="comment">//fullforwardshadows 在正向渲染路径中支持所有阴影类型</span></span><br><span class="line">        <span class="meta">#<span class="keyword">pragma</span> surface surf Standard fullforwardshadows</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use shader model 3.0 target, to get nicer looking lighting</span></span><br><span class="line">        <span class="meta">#<span class="keyword">pragma</span> target 3.0</span></span><br><span class="line"></span><br><span class="line">        sampler2D _MainTex;</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Input</span></span></span><br><span class="line"><span class="class">        &#123;</span></span><br><span class="line">            <span class="comment">//表示纹理 uv+纹理名称</span></span><br><span class="line">            float2 uv_MainTex;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        half _Glossiness;</span><br><span class="line">        half _Metallic;</span><br><span class="line">        fixed4 _Color;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// #pragma instancing_options assumeuniformscaling</span></span><br><span class="line">        UNITY_INSTANCING_BUFFER_START(Props)</span><br><span class="line">            <span class="comment">// put more per-instance properties here</span></span><br><span class="line">        UNITY_INSTANCING_BUFFER_END(Props)</span><br><span class="line"></span><br><span class="line">        <span class="type">void</span> <span class="title function_">surf</span> <span class="params">(Input IN, inout SurfaceOutputStandard o)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Albedo comes from a texture tinted by color</span></span><br><span class="line">            fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color;</span><br><span class="line">            <span class="comment">//漫反射颜色值</span></span><br><span class="line">            o.Albedo = c.rgb;</span><br><span class="line">            <span class="comment">//金属值</span></span><br><span class="line">            o.Metallic = _Metallic;</span><br><span class="line">            <span class="comment">//平滑值</span></span><br><span class="line">            o.Smoothness = _Glossiness;</span><br><span class="line">            <span class="comment">//透明度</span></span><br><span class="line">            o.Alpha = c.a;</span><br><span class="line">        &#125;</span><br><span class="line">        ENDCG</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;Diffuse&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="LOD值"><a href="#LOD值" class="headerlink" title="LOD值"></a>LOD值</h1><p><img src="/../images/image-20230509164630883.png" alt="image-20230509164630883"></p>
<h1 id="渲染队列"><a href="#渲染队列" class="headerlink" title="渲染队列"></a>渲染队列</h1><p><img src="/../images/image-20230509181116997.png" alt="image-20230509181116997"></p>
<h1 id="高光"><a href="#高光" class="headerlink" title="高光"></a>高光</h1><h2 id="逐顶点高光"><a href="#逐顶点高光" class="headerlink" title="逐顶点高光"></a>逐顶点高光</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_Object2World&#x27; with &#x27;unity_ObjectToWorld&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Unlit/逐顶点高光&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Specular(<span class="string">&quot;Specular&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>,Range(<span class="number">1.0</span>,<span class="number">256</span>))=<span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="comment">//#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line">            <span class="comment">//引用了Lighting.cginc文件，这个文件中包含了一些和光照计算相关的函数和变量。</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            <span class="comment">//定义了一个名为_Diffuse的uniform变量，用于存储物体表面的颜色。</span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="type">float</span> _Gloss;</span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">a2v</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">                <span class="comment">// 模型的第一套纹理</span></span><br><span class="line">                float4 texcoord:TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                <span class="comment">// 存储颜色信息</span></span><br><span class="line">                fixed3 color : COLOR0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span><span class="params">(a2v v)</span> &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//UNITY_LIGHTMODEL_AMBIENT.xyz;: 获取环境光照颜色。</span></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//将顶点法线从模型空间转换到世界空间，并归一化。</span></span><br><span class="line">                <span class="comment">//fixed3 worldNormal = normalize(mul(v.normal, (float3x3)unity_WorldToObject));</span></span><br><span class="line">                fixed3 worldNormal =  normalize(mul(unity_ObjectToWorld,v.normal));</span><br><span class="line">                <span class="comment">//获取光源在世界空间中的位置，并归一化。</span></span><br><span class="line">                fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                <span class="comment">//计算漫反射颜色，使用光源的颜色</span></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * (dot(worldNormal, worldLightDir)*<span class="number">0.5</span>+<span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment">//根据reflect函数获取r值（光线入射方向相对法线的射出方向）</span></span><br><span class="line">                fixed3 reflectDir=normalize(reflect(-worldLightDir,worldNormal));</span><br><span class="line">                <span class="comment">//获取观察方向</span></span><br><span class="line">                fixed3 viewDir=normalize(_WorldSpaceCameraPos.xyz-mul(unity_ObjectToWorld,v.vertex).xyz);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//c*m*(pow(dot(v*r))</span></span><br><span class="line">                fixed3 specular=_LightColor0.rgb*_Specular.rgb*<span class="built_in">pow</span>(saturate(dot(reflectDir,viewDir)),_Gloss);</span><br><span class="line">                o.color = ambient + diffuse+specular;</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span><br><span class="line">               fixed3 c = i.color;</span><br><span class="line">               <span class="keyword">return</span> fixed4(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;DIFFUSE&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="逐像素高光"><a href="#逐像素高光" class="headerlink" title="逐像素高光"></a>逐像素高光</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Unlit/逐像素高光&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Specular(<span class="string">&quot;Specular&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>,Range(<span class="number">1.0</span>,<span class="number">256</span>))=<span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="type">float</span> _Gloss;</span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">a2v</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                float3 worldNormal:TEXCOORD0;</span><br><span class="line">                float3 worldPos:TEXCOORD1;</span><br><span class="line">                float3 viewDir:TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span><span class="params">(a2v v)</span> &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                <span class="comment">//将顶点法线从模型空间转换到世界空间，并归一化。</span></span><br><span class="line">                <span class="comment">//o.worldNormal = normalize(mul(v.normal, (float3x3)unity_WorldToObject));</span></span><br><span class="line"></span><br><span class="line">                 <span class="comment">//o.worldNormal =  normalize(mul(unity_ObjectToWorld,v.normal));</span></span><br><span class="line">                 o.worldNormal=normalize(UnityObjectToWorldDir(v.normal));</span><br><span class="line">                <span class="comment">//世界空间顶点坐标</span></span><br><span class="line">                o.worldPos = normalize(mul(unity_ObjectToWorld,v.vertex)).xyz;</span><br><span class="line">                o.viewDir=normalize(_WorldSpaceCameraPos.xyz-o.worldPos.xyz);</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span><br><span class="line">               <span class="comment">//UNITY_LIGHTMODEL_AMBIENT.xyz;: 获取环境光照颜色。</span></span><br><span class="line">               fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">               fixed3 worldNormal=normalize(i.worldNormal);</span><br><span class="line">               fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line">               <span class="type">float</span> halfLambert = dot(worldNormal,worldLightDir)*<span class="number">0.5</span>+<span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*saturate(dot(worldNormal,worldLightDir));</span></span><br><span class="line">               fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*halfLambert;</span><br><span class="line"></span><br><span class="line">               fixed3 reflectDir=normalize(reflect(-worldLightDir,worldNormal));</span><br><span class="line"></span><br><span class="line">               fixed3 specular =_LightColor0.rgb*_Specular.rgb*(<span class="built_in">pow</span>(saturate(dot(reflectDir,i.viewDir)),_Gloss));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               fixed3 c = specular+ambient+diffuse;</span><br><span class="line">               <span class="keyword">return</span> fixed4(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;DIFFUSE&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Blinn-Phong高光"><a href="#Blinn-Phong高光" class="headerlink" title="Blinn-Phong高光"></a>Blinn-Phong高光</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Unlit/Blinn-Phong反射&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Specular(<span class="string">&quot;Specular&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>,Range(<span class="number">1.0</span>,<span class="number">256</span>))=<span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="type">float</span> _Gloss;</span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">a2v</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                float3 worldNormal:TEXCOORD0;</span><br><span class="line">                float3 worldPos:TEXCOORD1;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span><span class="params">(a2v v)</span> &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                <span class="comment">//将顶点法线从模型空间转换到世界空间，并归一化。</span></span><br><span class="line">                <span class="comment">//o.worldNormal = normalize(mul(v.normal, (float3x3)unity_WorldToObject));</span></span><br><span class="line">                 o.worldNormal =  normalize(mul(unity_ObjectToWorld,v.normal));</span><br><span class="line">                <span class="comment">//世界空间顶点坐标</span></span><br><span class="line">                o.worldPos = normalize(mul(unity_ObjectToWorld,v.vertex)).xyz;</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span><br><span class="line">               <span class="comment">//UNITY_LIGHTMODEL_AMBIENT.xyz;: 获取环境光照颜色。</span></span><br><span class="line">               fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">               fixed3 worldNormal=normalize(i.worldNormal);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               <span class="comment">//fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz);</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">//根据世界坐标位置顶点位置，返回从该点到光源的方向向量</span></span><br><span class="line">               fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">               <span class="type">float</span> halfLambert = dot(worldNormal,worldLightDir)*<span class="number">0.5</span>+<span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*saturate(dot(worldNormal,worldLightDir));</span></span><br><span class="line">               fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*halfLambert;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//fixed3 reflectDir=normalize(reflect(-worldLightDir,worldNormal));</span></span><br><span class="line">               </span><br><span class="line"></span><br><span class="line">               <span class="comment">//fixed3 viewDir=normalize(_WorldSpaceCameraPos.xyz-i.worldPos.xyz);</span></span><br><span class="line">               </span><br><span class="line">               <span class="comment">//根据世界坐标位置顶点位置，返回从该点到摄像机的方向向量</span></span><br><span class="line">               fixed3 viewDir=normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line">               fixed3 halfDir=normalize(worldLightDir+viewDir);</span><br><span class="line"></span><br><span class="line">               fixed3 specular =_LightColor0.rgb*_Specular.rgb*(<span class="built_in">pow</span>(saturate(dot(worldNormal,halfDir)),_Gloss));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               fixed3 c = ambient+diffuse+specular;</span><br><span class="line">               <span class="keyword">return</span> fixed4(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;DIFFUSE&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="纹理"><a href="#纹理" class="headerlink" title="纹理"></a>纹理</h1><h2 id="单纹理"><a href="#单纹理" class="headerlink" title="单纹理"></a>单纹理</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Texture/单纹理&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Tex_Color(<span class="string">&quot;Tex_Color&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Specular(<span class="string">&quot;Specular&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>,Range(<span class="number">1.0</span>,<span class="number">256</span>))=<span class="number">20</span></span><br><span class="line">        _MainTex(<span class="string">&quot;Main_Tex&quot;</span>,<span class="number">2</span>D)=<span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="type">float</span> _Gloss;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            fixed4 _Tex_Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            <span class="comment">//_MainTex的缩放和平移  xy为缩放，zw为平移</span></span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">a2v</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">                float4 texcoord:TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                float3 worldNormal:TEXCOORD0;</span><br><span class="line">                float3 worldPos:TEXCOORD1;</span><br><span class="line">                float2 uv:TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span><span class="params">(a2v v)</span> &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                <span class="comment">//将顶点法线从模型空间转换到世界空间，并归一化。</span></span><br><span class="line">                o.worldNormal =normalize(mul(v.normal,(float3x3)unity_WorldToObject));</span><br><span class="line">                <span class="comment">//世界空间顶点坐标</span></span><br><span class="line">                o.worldPos = normalize(mul(unity_ObjectToWorld,v.vertex)).xyz;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//o.uv=TRANSFORM_TEX(v.texcoord,_MainTex); 与下方代码相同</span></span><br><span class="line">                o.uv=v.texcoord.xy*_MainTex_ST.xy+_MainTex_ST.zw;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//获取纹理颜色</span></span><br><span class="line">               fixed3 albedo=tex2D(_MainTex,i.uv).rgb*_Tex_Color.rgb; </span><br><span class="line">               <span class="comment">//将纹理颜色添加到环境光中</span></span><br><span class="line">               fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz*   albedo;</span><br><span class="line"></span><br><span class="line">               fixed3 worldNormal=normalize(i.worldNormal);</span><br><span class="line">               <span class="comment">//根据世界坐标位置顶点位置，返回从该点到光源的方向向量</span></span><br><span class="line">               fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">               <span class="type">float</span> halfLambert = dot(worldNormal,worldLightDir)*<span class="number">0.5</span>+<span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//将纹理颜色添加到漫反射中</span></span><br><span class="line">               fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*halfLambert   *albedo;</span><br><span class="line">               <span class="comment">//diffuse= _LightColor0.rgb * _Diffuse.rgb*saturate(dot(worldNormal,worldLightDir));</span></span><br><span class="line">               <span class="comment">//根据世界坐标位置顶点位置，返回从该点到摄像机的方向向量</span></span><br><span class="line">               fixed3 viewDir=normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line">               fixed3 halfDir=normalize(worldLightDir+viewDir);</span><br><span class="line">               fixed3 specular =_LightColor0.rgb*_Specular.rgb*(<span class="built_in">pow</span>(saturate(dot(worldNormal,halfDir)),_Gloss));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               fixed3 c = ambient+diffuse+specular;</span><br><span class="line">               <span class="keyword">return</span> fixed4(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;SPECULAR&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="切线空间法线纹理"><a href="#切线空间法线纹理" class="headerlink" title="切线空间法线纹理"></a>切线空间法线纹理</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Texture/切线空间法线纹理&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Tex_Color(<span class="string">&quot;Tex_Color&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>,Range(<span class="number">0</span>,<span class="number">10</span>))=<span class="number">5</span></span><br><span class="line">        _MainTex(<span class="string">&quot;Main_Tex&quot;</span>,<span class="number">2</span>D)=<span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        _BumpMap(<span class="string">&quot;BumpMap&quot;</span>,<span class="number">2</span>D)=<span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line">        _Specular_Tex(<span class="string">&quot;Specular_Tex&quot;</span>,<span class="number">2</span>d) = <span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line">        _BumpScale(<span class="string">&quot;BumpScale&quot;</span>,Range(<span class="number">-20</span>,<span class="number">20</span>))=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="type">float</span> _Gloss;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            fixed4 _Tex_Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            <span class="comment">//_MainTex的缩放和平移  xy为缩放，zw为平移</span></span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            sampler2D _Specular_Tex;</span><br><span class="line">            float4 _Specular_Tex_ST;</span><br><span class="line">            <span class="comment">//缩放值</span></span><br><span class="line">            <span class="type">float</span> _BumpScale;</span><br><span class="line"></span><br><span class="line">            sampler2D _BumpMap;</span><br><span class="line">            <span class="comment">//_BumpMap的缩放和平移  xy为缩放，zw为平移</span></span><br><span class="line">            float4 _BumpMap_ST;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">a2v</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">                float4 texcoord:TEXCOORD0;</span><br><span class="line"></span><br><span class="line">                float4 tangent:TANGENT;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                float4 uv:TEXCOORD0;</span><br><span class="line">                float3 lightDit:TEXCOORD1;</span><br><span class="line">                float3 viewDir:TEXCOORD2;</span><br><span class="line">                float2 specular_uv:TEXCOORD3;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span><span class="params">(a2v v)</span> &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                <span class="comment">//变换到纹理坐标</span></span><br><span class="line">                o.uv.xy=v.texcoord.xy*_MainTex_ST.xy+_MainTex_ST.zw;</span><br><span class="line">                o.uv.zw=v.texcoord.xy*_BumpMap_ST.xy+_BumpMap_ST.zw;</span><br><span class="line">                o.specular_uv=v.texcoord.xy*_Specular_Tex_ST.xy+_Specular_Tex_ST.zw;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//使用unity自带的宏计算从模型空间到切线空间的变化矩阵或自己写</span></span><br><span class="line">                TANGENT_SPACE_ROTATION;</span><br><span class="line">                <span class="comment">//副切线</span></span><br><span class="line">                <span class="comment">//float3 binormal=cross(normalize(v.normal),normalize(v.tangent.xyz))*v.tangent.w;</span></span><br><span class="line">                <span class="comment">//模型空间-&gt;切线空间变换</span></span><br><span class="line">                <span class="comment">//float3x3 rotation=float3x3(v.tangent.xyz,binormal,v.normal);</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//ObjSpaceLightDir 获取模型空间下顶点指向光源的方向</span></span><br><span class="line">                o.lightDit=mul(rotation,ObjSpaceLightDir(v.vertex)).xyz;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//ObjSpaceViewDir 获取模型空间下顶点指向光源的方向</span></span><br><span class="line">                o.viewDir=mul(rotation,ObjSpaceViewDir(v.vertex)).xyz;</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//切线观察方向</span></span><br><span class="line">               fixed3 tangentViewDir=normalize(i.viewDir);</span><br><span class="line">               <span class="comment">//切线光源方向</span></span><br><span class="line">               fixed3 tangentLightDir=normalize(i.lightDit);</span><br><span class="line">               <span class="comment">//法线纹理法线颜色</span></span><br><span class="line">               fixed4 packedNormal = tex2D(_BumpMap,i.uv.zw);</span><br><span class="line">               fixed3 tangentNormal;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//tangentNormal.xy=(packedNormal.xy*2-1);</span></span><br><span class="line">               <span class="comment">//颜色值-&gt;法线</span></span><br><span class="line">               tangentNormal=UnpackNormal(packedNormal);</span><br><span class="line"></span><br><span class="line">               tangentNormal.xy*=_BumpScale;</span><br><span class="line">               <span class="comment">//计算z坐标</span></span><br><span class="line">               tangentNormal.z=<span class="built_in">sqrt</span>(<span class="number">1</span>-saturate(dot(tangentNormal.xy,tangentNormal.xy)));</span><br><span class="line"></span><br><span class="line">               <span class="comment">//获取纹理颜色</span></span><br><span class="line">               fixed3 albedo=tex2D(_MainTex,i.uv.xy).rgb*_Tex_Color.rgb; </span><br><span class="line">               <span class="comment">//将纹理颜色添加到环境光中</span></span><br><span class="line">               fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz*albedo;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//法线和光源方向的点乘  半兰伯特模型</span></span><br><span class="line">               <span class="type">float</span> halfLambert = dot(tangentNormal,tangentLightDir)*<span class="number">0.5</span>+<span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//将纹理颜色添加到漫反射中</span></span><br><span class="line">               fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*halfLambert   *albedo;</span><br><span class="line">               <span class="comment">//diffuse= _LightColor0.rgb * _Diffuse.rgb*saturate(dot(tangentNormal,tangentLightDir));</span></span><br><span class="line">               </span><br><span class="line">               <span class="comment">//高光颜色</span></span><br><span class="line">               fixed3 _Specular= tex2D(_Specular_Tex,i.specular_uv);</span><br><span class="line"></span><br><span class="line">               <span class="comment">//半程向量 光源方向和观察方向</span></span><br><span class="line">               fixed3 halfDir=normalize(tangentLightDir+tangentViewDir);</span><br><span class="line">               fixed3 specular =_LightColor0.rgb*_Specular.rgb*(<span class="built_in">pow</span>(saturate(dot(tangentNormal,halfDir)),_Gloss));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               fixed3 c = ambient+diffuse+specular;</span><br><span class="line">               <span class="keyword">return</span> fixed4(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;SPECULAR&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="世界空间法线纹理"><a href="#世界空间法线纹理" class="headerlink" title="世界空间法线纹理"></a>世界空间法线纹理</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;Texture/世界空间法线纹理&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Tex_Color(<span class="string">&quot;Tex_Color&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>,Range(<span class="number">0</span>,<span class="number">10</span>))=<span class="number">5</span></span><br><span class="line">        _MainTex(<span class="string">&quot;Main_Tex&quot;</span>,<span class="number">2</span>D)=<span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        _BumpMap(<span class="string">&quot;BumpMap&quot;</span>,<span class="number">2</span>D)=<span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line">        _Specular_Tex(<span class="string">&quot;Specular_Tex&quot;</span>,<span class="number">2</span>d) = <span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line">        _BumpScale(<span class="string">&quot;BumpScale&quot;</span>,Range(<span class="number">-20</span>,<span class="number">20</span>))=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="type">float</span> _Gloss;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            fixed4 _Tex_Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            <span class="comment">//_MainTex的缩放和平移  xy为缩放，zw为平移</span></span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            sampler2D _Specular_Tex;</span><br><span class="line">            float4 _Specular_Tex_ST;</span><br><span class="line">            <span class="comment">//缩放值</span></span><br><span class="line">            <span class="type">float</span> _BumpScale;</span><br><span class="line"></span><br><span class="line">            sampler2D _BumpMap;</span><br><span class="line">            <span class="comment">//_BumpMap的缩放和平移  xy为缩放，zw为平移</span></span><br><span class="line">            float4 _BumpMap_ST;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">a2v</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">                float4 texcoord:TEXCOORD0;</span><br><span class="line"></span><br><span class="line">                float4 tangent:TANGENT;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                float4 uv:TEXCOORD0;</span><br><span class="line">                float4 TtoW0:TEXCOORD1;</span><br><span class="line">                float4 TtoW1:TEXCOORD2;</span><br><span class="line">                float4 TtoW2:TEXCOORD3;</span><br><span class="line">                float2 specular_uv:TEXCOORD4;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span><span class="params">(a2v v)</span> &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.uv.xy=v.texcoord.xy*_MainTex_ST.xy+_MainTex_ST.zw;</span><br><span class="line">                o.uv.zw=v.texcoord.xy*_BumpMap_ST.xy+_BumpMap_ST.zw;</span><br><span class="line">                o.specular_uv=v.texcoord.xy*_Specular_Tex_ST.xy+_Specular_Tex_ST.zw;</span><br><span class="line"></span><br><span class="line">                float3 worldPos=mul(unity_ObjectToWorld,v.vertex).xyz;</span><br><span class="line">                fixed3 worldNormal=UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                fixed3 worldTangent=UnityObjectToWorldDir(v.tangent.xyz);</span><br><span class="line">                fixed3 worldBinormal=cross(worldNormal,worldTangent)*v.tangent.w;</span><br><span class="line">                </span><br><span class="line">                o.TtoW0=float4(worldTangent.x,worldBinormal.x,worldNormal.x,worldPos.x);</span><br><span class="line">                o.TtoW1=float4(worldTangent.y,worldBinormal.y,worldNormal.y,worldPos.y);</span><br><span class="line">                o.TtoW2=float4(worldTangent.z,worldBinormal.z,worldNormal.z,worldPos.z);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span><br><span class="line"></span><br><span class="line">               float3 worldPos=float3(i.TtoW0.w,i.TtoW1.w,i.TtoW2.w);</span><br><span class="line">               fixed3 worldViewDir=normalize(UnityWorldSpaceViewDir(worldPos));</span><br><span class="line">               fixed3 worldLightDir=normalize(UnityWorldSpaceLightDir(worldPos));</span><br><span class="line">               fixed4 packedNormal = tex2D(_BumpMap,i.uv.zw);</span><br><span class="line"></span><br><span class="line">               <span class="comment">//世界空间下凹凸纹理</span></span><br><span class="line">               fixed3 worldBumpNormal=UnpackNormal(packedNormal);</span><br><span class="line">               worldBumpNormal.xy*=_BumpScale;</span><br><span class="line">               worldBumpNormal.z=<span class="built_in">sqrt</span>(<span class="number">1</span>-saturate(dot(worldBumpNormal.xy,worldBumpNormal.xy)));</span><br><span class="line">               worldBumpNormal=normalize(half3(dot(i.TtoW0.xyz,worldBumpNormal),</span><br><span class="line">                                               dot(i.TtoW1.xyz,worldBumpNormal),</span><br><span class="line">                                               dot(i.TtoW2.xyz,worldBumpNormal)));</span><br><span class="line"></span><br><span class="line">               <span class="comment">//获取纹理颜色</span></span><br><span class="line">               fixed3 albedo=tex2D(_MainTex,i.uv.xy).rgb*_Tex_Color.rgb; </span><br><span class="line">               <span class="comment">//将纹理颜色添加到环境光中</span></span><br><span class="line">               fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz*albedo;</span><br><span class="line"></span><br><span class="line">               <span class="type">float</span> halfLambert = dot(worldBumpNormal,worldLightDir)*<span class="number">0.5</span>+<span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//将纹理颜色添加到漫反射中</span></span><br><span class="line">               fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*halfLambert   *albedo;</span><br><span class="line">               <span class="comment">//diffuse= _LightColor0.rgb * _Diffuse.rgb*saturate(dot(worldBumpNormal,worldLightDir));</span></span><br><span class="line">               </span><br><span class="line">               fixed3 _Specular= tex2D(_Specular_Tex,i.specular_uv);</span><br><span class="line"></span><br><span class="line">               fixed3 halfDir=normalize(worldLightDir+worldViewDir);</span><br><span class="line">               fixed3 specular =_LightColor0.rgb*_Specular.rgb*(<span class="built_in">pow</span>(saturate(dot(worldBumpNormal,halfDir)),_Gloss));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               fixed3 c = ambient+diffuse+specular;</span><br><span class="line">               <span class="keyword">return</span> fixed4(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;SPECULAR&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="渐变纹理"><a href="#渐变纹理" class="headerlink" title="渐变纹理"></a>渐变纹理</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;_World2Object&#x27; with &#x27;unity_WorldToObject&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader <span class="string">&quot;渐变纹理/渐变纹理&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Tex_Color(<span class="string">&quot;Tex_Color&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Diffuse(<span class="string">&quot;Diffuse&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Specular(<span class="string">&quot;Specular&quot;</span>,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _Gloss(<span class="string">&quot;Gloss&quot;</span>,Range(<span class="number">1.0</span>,<span class="number">256</span>))=<span class="number">20</span></span><br><span class="line">        _MainTex(<span class="string">&quot;Main_Tex&quot;</span>,<span class="number">2</span>D)=<span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        _RampTex(<span class="string">&quot;Ramp_Tex&quot;</span>,<span class="number">2</span>D)=<span class="string">&quot;white&quot;</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//指定SubShader的LOD等级，这里是最高的100级，表示该SubShader在任何情况下都应该被渲染。</span></span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里指定了LightMode标签为ForwardBase，表示该Pass会参与到正向渲染中，用于处理基础光照。</span></span><br><span class="line">            Tags &#123; <span class="string">&quot;LightMode&quot;</span> = <span class="string">&quot;ForwardBase&quot;</span> &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UnityCG.cginc&quot;</span></span></span><br><span class="line">            <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Lighting.cginc&quot;</span></span></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="type">float</span> _Gloss;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            fixed4 _Tex_Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            <span class="comment">//_MainTex的缩放和平移  xy为缩放，zw为平移</span></span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            </span><br><span class="line">            sampler2D _RampTex;</span><br><span class="line">            <span class="comment">//_MainTex的缩放和平移  xy为缩放，zw为平移</span></span><br><span class="line">            float4 _RampTex_ST;</span><br><span class="line">            <span class="comment">//定义结构体</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">a2v</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 模型空间顶点坐标</span></span><br><span class="line">                float4 vertex:POSITION;</span><br><span class="line">                <span class="comment">// 模型空间法线方向</span></span><br><span class="line">                float3 normal:NORMAL;</span><br><span class="line">                float4 texcoord:TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">v2f</span> &#123;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 顶点在裁剪空间的位置信息</span></span><br><span class="line">                float4 pos:SV_POSITION;</span><br><span class="line">                float3 worldNormal:TEXCOORD0;</span><br><span class="line">                float3 worldPos:TEXCOORD1;</span><br><span class="line">                float4 uv:TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f <span class="title function_">vert</span><span class="params">(a2v v)</span> &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                <span class="comment">//顶点的位置从对象空间转换到剪裁空间</span></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                <span class="comment">//将顶点法线从模型空间转换到世界空间，并归一化。</span></span><br><span class="line">                o.worldNormal =normalize(mul(v.normal,(float3x3)unity_WorldToObject));</span><br><span class="line">                <span class="comment">//世界空间顶点坐标</span></span><br><span class="line">                o.worldPos = normalize(mul(unity_ObjectToWorld,v.vertex)).xyz;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//o.uv=TRANSFORM_TEX(v.texcoord,_MainTex); 与下方代码相同</span></span><br><span class="line">                o.uv.xy=v.texcoord.xy*_MainTex_ST.xy+_MainTex_ST.zw;</span><br><span class="line"></span><br><span class="line">                o.uv.zw=v.texcoord.xy*_RampTex_ST.xy+_RampTex_ST.zw;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">            fixed4 <span class="title function_">frag</span><span class="params">(v2f i)</span> : SV_Target&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               fixed3 worldNormal=normalize(i.worldNormal);</span><br><span class="line">               <span class="comment">//根据世界坐标位置顶点位置，返回从该点到光源的方向向量</span></span><br><span class="line">               fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">               <span class="type">float</span> halfLambert = dot(worldNormal,worldLightDir)*<span class="number">0.5</span>+<span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//获取纹理颜色+渐变纹理颜色</span></span><br><span class="line">               fixed3 albedo=tex2D(_MainTex,i.uv.xy).rgb*_Tex_Color.rgb+tex2D(_RampTex,fixed2(halfLambert,halfLambert)).rgb; </span><br><span class="line">               <span class="comment">//将纹理颜色添加到环境光中</span></span><br><span class="line">               fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz*   albedo;</span><br><span class="line"></span><br><span class="line">               </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               <span class="comment">//将纹理颜色添加到漫反射中</span></span><br><span class="line">               fixed3 diffuse= _LightColor0.rgb * _Diffuse.rgb*halfLambert   *albedo;</span><br><span class="line">               <span class="comment">//diffuse= _LightColor0.rgb * _Diffuse.rgb*saturate(dot(worldNormal,worldLightDir));</span></span><br><span class="line">               <span class="comment">//根据世界坐标位置顶点位置，返回从该点到摄像机的方向向量</span></span><br><span class="line">               fixed3 viewDir=normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line">               fixed3 halfDir=normalize(worldLightDir+viewDir);</span><br><span class="line">               fixed3 specular =_LightColor0.rgb*_Specular.rgb*(<span class="built_in">pow</span>(saturate(dot(worldNormal,halfDir)),_Gloss));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               fixed3 c = ambient+diffuse+specular;</span><br><span class="line">               <span class="keyword">return</span> fixed4(c,<span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack <span class="string">&quot;SPECULAR&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="混合模式"><a href="#混合模式" class="headerlink" title="混合模式"></a>混合模式</h1><p><img src="/../images/image-20230516120119488.png" alt="image-20230516120119488"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" rel="tag"># 图形学</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/04/27/%E7%8E%B0%E4%BB%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%85%A5%E6%A2%A602/" rel="prev" title="现代计算机图形学入梦02">
      <i class="fa fa-chevron-left"></i> 现代计算机图形学入梦02
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%85%E5%AE%B9"><span class="nav-number">1.</span> <span class="nav-text">内容</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text">基本类型表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E8%AF%AD%E4%B9%89"><span class="nav-number">2.2.</span> <span class="nav-text">结构体和语义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#unity%E6%94%AF%E6%8C%81%E7%9A%84shader%E8%AF%AD%E4%B9%89"><span class="nav-number">2.3.</span> <span class="nav-text">unity支持的shader语义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E5%87%86%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="nav-number">2.4.</span> <span class="nav-text">标准内置函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#float4-fixed4-Time"><span class="nav-number">2.5.</span> <span class="nav-text">float4 fixed4 _Time</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UnityObjectToClipPos"><span class="nav-number">2.6.</span> <span class="nav-text">UnityObjectToClipPos</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SV-POSITION"><span class="nav-number">2.7.</span> <span class="nav-text">SV_POSITION</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Diffuse"><span class="nav-number">2.8.</span> <span class="nav-text">Diffuse</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SV-Target"><span class="nav-number">2.9.</span> <span class="nav-text">SV_Target</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Properties%E5%B1%9E%E6%80%A7"><span class="nav-number">2.10.</span> <span class="nav-text">Properties属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TRANSFORM-TEX"><span class="nav-number">2.11.</span> <span class="nav-text">TRANSFORM_TEX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tex2D"><span class="nav-number">2.12.</span> <span class="nav-text">tex2D</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E7%A9%BA%E9%97%B4%E3%80%81%E4%B8%96%E7%95%8C%E7%A9%BA%E9%97%B4%E3%80%81%E8%A7%82%E5%AF%9F%E7%A9%BA%E9%97%B4%E5%92%8C%E8%A3%81%E5%89%AA%E7%A9%BA%E9%97%B4"><span class="nav-number">3.</span> <span class="nav-text">模型空间、世界空间、观察空间和裁剪空间</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#01"><span class="nav-number">4.</span> <span class="nav-text">01</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#02"><span class="nav-number">5.</span> <span class="nav-text">02</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%A7%E8%B0%83%E8%AF%95%E5%99%A8"><span class="nav-number">6.</span> <span class="nav-text">帧调试器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Shader-Target-%E7%BC%96%E8%AF%91%E7%9A%84%E7%9B%AE%E6%A0%87%E5%B9%B3%E5%8F%B0"><span class="nav-number">7.</span> <span class="nav-text">Shader Target 编译的目标平台</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BRDF%E6%A8%A1%E5%9E%8B"><span class="nav-number">8.</span> <span class="nav-text">BRDF模型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%85%89%E7%85%A7"><span class="nav-number">9.</span> <span class="nav-text">反射光照</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%90%E9%A1%B6%E7%82%B9%E6%BC%AB%E5%8F%8D%E5%B0%84%E5%85%89%E7%85%A7"><span class="nav-number">9.1.</span> <span class="nav-text">逐顶点漫反射光照</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%90%E5%83%8F%E7%B4%A0%E6%BC%AB%E5%8F%8D%E5%B0%84%E5%85%89%E7%85%A7"><span class="nav-number">9.2.</span> <span class="nav-text">逐像素漫反射光照</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AD%A3%E6%97%8B%E6%B3%A2%E5%92%8CUV%E5%8A%A8%E7%94%BB"><span class="nav-number">10.</span> <span class="nav-text">正旋波和UV动画</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sin%E6%B3%A2%E7%BA%B9"><span class="nav-number">10.1.</span> <span class="nav-text">sin波纹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UV%E5%8A%A8%E7%94%BB"><span class="nav-number">10.2.</span> <span class="nav-text">UV动画</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A1%A8%E9%9D%A2%E7%9D%80%E8%89%B2%E5%99%A8"><span class="nav-number">11.</span> <span class="nav-text">表面着色器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-number">11.1.</span> <span class="nav-text">入口函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E9%80%89%E5%8F%82%E6%95%B0"><span class="nav-number">11.2.</span> <span class="nav-text">可选参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Input%E9%99%84%E5%8A%A0%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">11.3.</span> <span class="nav-text">Input附加的数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SurfaceOutput%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-number">11.4.</span> <span class="nav-text">SurfaceOutput结构体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E8%A1%A8%E9%9D%A2%E7%9D%80%E8%89%B2%E5%99%A8%E4%BB%A3%E7%A0%81"><span class="nav-number">11.5.</span> <span class="nav-text">简单表面着色器代码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LOD%E5%80%BC"><span class="nav-number">12.</span> <span class="nav-text">LOD值</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E9%98%9F%E5%88%97"><span class="nav-number">13.</span> <span class="nav-text">渲染队列</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AB%98%E5%85%89"><span class="nav-number">14.</span> <span class="nav-text">高光</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%90%E9%A1%B6%E7%82%B9%E9%AB%98%E5%85%89"><span class="nav-number">14.1.</span> <span class="nav-text">逐顶点高光</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%90%E5%83%8F%E7%B4%A0%E9%AB%98%E5%85%89"><span class="nav-number">14.2.</span> <span class="nav-text">逐像素高光</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Blinn-Phong%E9%AB%98%E5%85%89"><span class="nav-number">14.3.</span> <span class="nav-text">Blinn-Phong高光</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BA%B9%E7%90%86"><span class="nav-number">15.</span> <span class="nav-text">纹理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E7%BA%B9%E7%90%86"><span class="nav-number">15.1.</span> <span class="nav-text">单纹理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%87%E7%BA%BF%E7%A9%BA%E9%97%B4%E6%B3%95%E7%BA%BF%E7%BA%B9%E7%90%86"><span class="nav-number">15.2.</span> <span class="nav-text">切线空间法线纹理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%96%E7%95%8C%E7%A9%BA%E9%97%B4%E6%B3%95%E7%BA%BF%E7%BA%B9%E7%90%86"><span class="nav-number">16.</span> <span class="nav-text">世界空间法线纹理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B8%90%E5%8F%98%E7%BA%B9%E7%90%86"><span class="nav-number">17.</span> <span class="nav-text">渐变纹理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="nav-number">18.</span> <span class="nav-text">混合模式</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="心梦"
      src="/images/ailulu.jpg">
  <p class="site-author-name" itemprop="name">心梦</p>
  <div class="site-description" itemprop="description">heart_dream</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/heartdream520" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;heartdream520" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.acwing.com/user/myspace/index/60784/" title="Acwing → https:&#x2F;&#x2F;www.acwing.com&#x2F;user&#x2F;myspace&#x2F;index&#x2F;60784&#x2F;" rel="noopener" target="_blank"><i class="fab fa-Acwing fa-fw"></i>Acwing</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codeforces.com/profile/Heart_dream" title="Codeforces → https:&#x2F;&#x2F;codeforces.com&#x2F;profile&#x2F;Heart_dream" rel="noopener" target="_blank"><i class="fab fa-codeforces fa-fw"></i>Codeforces</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">心梦</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">281k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:16</span>
</div>



        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
